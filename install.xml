<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<?xml-stylesheet type="text/xsl" href="modx.prosilver.en.xsl"?>
<!--NOTICE: Please open this file in your web browser. If presented with a security warning, you may safely tell it to allow the blocked content.-->
<!--For security purposes, please check: http://www.phpbb.com/mods/ for the latest version of this MOD.\nAlthough MODs are checked before being allowed in the MODs Database there is no guarantee that there are no security problems within the MOD.\nNo support will be given for MODs not found within the MODs Database which can be found at http://www.phpbb.com/mods/-->
<mod xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.phpbb.com/mods/xml/modx-1.2.5.xsd">
	<header>
		<meta name="generator" content="MODX file generated with PP MODX Creator by tumba25 (online version)"/>
		<license><![CDATA[http://opensource.org/licenses/gpl-license.php GNU General Public License v2]]></license>
		<title lang="en"><![CDATA[bbDKP]]></title>
		<title lang="de"><![CDATA[bbDKP]]></title>
		<title lang="fr"><![CDATA[bbDKP]]></title>
		<description lang="en"><![CDATA[bbDKP 1.2.7 is a Dragon Kill system Mod for your phpBB3 Bulletin board, developed from EQDKP. It is a multi-pool loot distribution system that supports Standard DKP, Time based DKP, Zero sum and EPGP. 
It integrates Game, Guild and DKP management facilites into your phpBB3 Forum. Your users have single sign on to dkp and phpBB3, and you as an administrator or raidleader get a clean interface, robust admin facilities and less integration headaches. 
Feature list : Portal with widgets, Dashboard, Statistics, Events, Raids, Member, Items, Roster, ACP and UCP modules.
The framework supports multiple games : World of Warcraft, The Lord of the Rings Online, Dark Age of Camelot, Vanguard - Saga of Heroes, EverQuest I/II, Warhammer Online, Final Fantasy XI, AION, Rift, SW:Tor
There are a number of plugins, like Raidtracker, bbTips, Memberimport, Apply, Bossprogress, Raidplanner (under development)

Further development requests, support questions are welcome at http://www.bbdkp.com. As of the current release, it does not (yet) make coffee ;)

Languages included:
» English (en)
» French (fr)
» Deutsch (de)

We ask that you retain the copyright notice in overall_footer.html in any Styles you use. It will help build interest in the bbDKP project, and is required for obtaining support.

bbDKP (c) 2011 Sajaki, Blazeflack
bbDKP (c) 2009 Sajaki, Kapli, Hroar, Malfate
bbDKP (c) 2008 Sajaki, Malfate, Kapli 
bbDKP (c) 2007 Ippeh, Teksonic, Monkeytech, DWKN
EQDkp (c) 2003 The EqDkp Project Team]]></description>
		<description lang="fr"><![CDATA[bbDKP 1.2.7 est une système DKP pour votre forum PHPBB3, developpee depuis EQDKP. Il est multi-pool, supporte le systeme DKP Standard, points par temps passé, Somme Zéro et EPGP.  Il aide les guildes à gérer leur Guilde, à savoir le suivi de la participation des membres au raids, la gestion des achats d‘objets, et bien d’autres statistiques. Il met à jour et incorpore ces fonctions de gestion, et les intègre dans PHPBB3. Ceci apportera à vos utilisateurs un point d’accès centralisé à DKP ainsi qu’au forum, et vous comme Administrateur ou leader de Raid recoit une interface claire et robuste et pas de soucis d’integration. Nous supportons les Jeux Aion, Daoc, Eq, Eq2, ffxi, lotro, vanguard, warhammer, World of Warcraft, Rift, SW:Tor. 
Liste non exhaustive des fonctionnalités : Multiples groupes DKP et guildes, Tribune des points DKP, Raids, Evènements, Valeurs des Objets, Historique des Objets, Statistique des Raids, Page d’avancée des Boss, Armurerie, module PCA avec Backup, Import de EQDKP+. 
Les Plugins : Importation depuis l’armurerie de Battle.NET, bbTips (Wow), Raidtracker (wow), Bossprogress, Formulaire de Recrutement, Planner
Pour de plus amples détails, veuillez consulter le changelog. Demandes de développement, questions de support sont les bienvenues à http://www.bbdkp.com. 

Langues inclues :
» Français (fr)
» English (en)
» Deutsch (de)

Veuillez montrer le la notice de copyright dans overall_footer.html dans les Styles que vous utilisez. Ceci aide à soutenir l’intérêt dans le projèt bbDKP et c’est requis afin d’obtenir du support.

bbDKP (c) 2011 Sajaki, Blazeflack
bbDKP (c) 2009 Sajaki, Kapli, Hroar, Malfate
bbDKP (c) 2008 Sajaki, Malfate, Kapli 
bbDKP (c) 2007 Ippeh, Teksonic, Monkeytech, DWKN
EQDkp (c) 2003 The EqDkp Project Team]]></description>
		<description lang="de"><![CDATA[bbDKP 1.2.7 ist eine DKP Lösung für ihr PHPBB3 Forum, weiterentwickelt aus EQDKP. Est ein multi-pool DKP System, und bietet Standard DKP, Zeitpunkteverwaltung, Nullpunkteverwaltung, und EPGP. Es ermöglicht die Gildenmitgliederverwaltung, die Raidteilnahme in Raids, die Verwaltung der Gegenstandsankäufe, verwaltung von DKP Konten, und GildenStatistiken. Sie erreichen damit ein einziges Angriffspunkt zum DKP und zum forum, mit eine überschauliche interface ohne Integrationsschwierigkeiten. bbDKP unterstützt jetzt Aion, Daoc, Eq, Eq2, ffxi, lotro, vanguard, warhammer, World of Warcraft und Rift. 
Nicht vollständige Funktionalitätenliste : Support für Vielfache DKP Gruppen (Pools), Vielfache Gilden, Ein Übersicht der DKP Punkte pro Spieler, Raidsliste, Ereignisliste, Gegenstandswerte, Historiken, Raidstatistiken, Gildenarsenalseite, ACP Modulen, Backupfunktionen, Import von EQDKP und EQDKP+. 
Vorhandene Plugins : Importation von Mitglieder Battle.NET, Bossvorgang, bbTips (tooltips), Raidtracker (wow), Rekrutierungsformular, Raidplaner
Für weitere Entwicklungsanfragen und Support heissen wir Sie wilkommen auf unsere internetseite http://www.bbdkp.com. 

Enthaltenen Sprachdateien:
» English (en)
» Deutsch (de)
» Français (fr)

Bitte zeige den copyright link in overall_footer.html in den Stylen die gebraucht werden. Es hilft dabei, Interesse in bbDKP zu verbreiten und ist erforderlich falls du Support bekommen willst.

bbDKP (c) 2011 Sajaki, Blazeflack
bbDKP (c) 2009 Sajaki, Kapli, Hroar, Malfate
bbDKP (c) 2008 Sajaki, Malfate, Kapli 
bbDKP (c) 2007 Ippeh, Teksonic, Monkeytech, DWKN
EQDkp (c) 2003 The EqDkp Project Team]]></description>
		<author-notes lang="en"><![CDATA[Requirements : phpBB3 v3.0.x, PHP 5.2 with Libxml 2.6.0 (simplexml usage), Curl 
Please read docs\INSTALL.html before beginning]]></author-notes>
		<author-notes lang="fr"><![CDATA[Requis : phpBB3 v3.0.x, PHP 5.2 avec Libxml 2.6.0 (simplexml), Curl 
Veuillez lire docs\INSTALL.html avant de commencer]]></author-notes>
		<author-notes lang="de"><![CDATA[Benötigt : phpBB3 v3.0.x, PHP 5.2 mit Libxml 2.6.0 (simplexml), Curl 
Bitte lesen sie docs\INSTALL.html bevor.]]></author-notes>
		<author-group>
			<author>
				<realname><![CDATA[Andy Vandenberghe]]></realname>
				<username><![CDATA[Sajaki]]></username>
				<homepage><![CDATA[http://www.bbdkp.com]]></homepage>
				<email><![CDATA[sajaki9@gmail.com]]></email>
				<contributions-group>
					<contributions status="current" from="2008-04-04" position="Developer"/>
				</contributions-group>
			</author>
			<author>
				<realname><![CDATA[Steffen]]></realname>
				<username><![CDATA[Blazeflack]]></username>
				<homepage><![CDATA[http://aegis.dk]]></homepage>
				<email><![CDATA[blazeflack@gmail.com]]></email>
				<contributions-group>
					<contributions status="past" from="2010-06-01" position="Supporter"/>
				</contributions-group>
			</author>
			<author>
				<realname><![CDATA[Kevin Rushin]]></realname>
				<username><![CDATA[Malfate / Medraut]]></username>
				<homepage><![CDATA[http://www.bbdkp.com]]></homepage>
				<email><![CDATA[cs.krushin@gmail.com]]></email>
				<contributions-group>
					<contributions status="past" from="2007-12-27" to="2009-01-01" position="Developer"/>
				</contributions-group>
			</author>
			<author>
				<username><![CDATA[Kapli]]></username>
				<contributions-group>
					<contributions status="past" from="2008-08-01" to="2009-04-01" position="Developer"/>
				</contributions-group>
			</author>
			<author>
				<realname><![CDATA[Teksonic]]></realname>
				<username><![CDATA[Teksonic]]></username>
				<contributions-group>
					<contributions status="past" from="2008-04-06" to="2008-06-01" position="Developer"/>
				</contributions-group>
			</author>
			<author>
				<realname><![CDATA[Ippeh]]></realname>
				<username><![CDATA[Ippeh]]></username>
				<homepage><![CDATA[http://www.explodinglabrats.com/]]></homepage>
				<email><![CDATA[ippe.he@gmail.com]]></email>
				<contributions-group>
					<contributions status="past" from="2007-12-24" to="2008-10-01" position="bbDKP Project Founder, Previous Developer"/>
				</contributions-group>
			</author>
			<author>
				<realname><![CDATA[Tsigo]]></realname>
				<username><![CDATA[Tsigo]]></username>
				<homepage><![CDATA[http://www.eqdkp.com]]></homepage>
				<contributions-group>
					<contributions status="past" position="original developer of EQDKP, on which this PHPBB MOD was inspired."/>
				</contributions-group>
			</author>
		</author-group>
		<mod-version>1.2.7</mod-version>
		<installation>
			<level>advanced</level>
			<time>1200</time>
			<target-version>3.0.10</target-version>
		</installation>
		<link-group>
			<link type="language" href="contrib/fr.xml" lang="en">French</link>
			<link type="language" href="contrib/fr.xml" lang="fr">Français</link>
			<link type="language" href="contrib/fr.xml" lang="de">Franzözisch</link>
			<link type="language" href="contrib/de.xml" lang="en">German</link>
			<link type="language" href="contrib/de.xml" lang="fr">Allemand</link>
			<link type="language" href="contrib/de.xml" lang="de">Deutsch</link>
			<link type="contrib" href="contrib/install_126PL5_to_127.xml" lang="en">Update from v1.2.6PL5 to v1.2.7</link>
			<link type="contrib" href="contrib/install_126PL5_to_127.xml" lang="fr">Mise à jour de v1.2.6PL5 à v1.2.7</link>
			<link type="contrib" href="contrib/install_126PL5_to_127.xml" lang="de">Aktualisierung von v1.2.6PL5 bis v1.2.7</link>
			<link type="text" href="docs/INSTALL.html" lang="en">Read me</link>
			<link type="text" href="docs/INSTALL.html" lang="fr">Lisez moi</link>
			<link type="text" href="docs/INSTALL.html" lang="de">Lies mich</link>
		</link-group>
	</header>
	<action-group>
		<copy>
			<file from="root/aboutbbdkp.php" to="aboutbbdkp.php"/>
			<file from="root/portal.php" to="portal.php"/>
			<file from="root/dkp.php" to="dkp.php"/>
			<file from="root/configdkp.php" to="configdkp.php"/>
			<file from="root/adm/images/glyphs/*.*" to="adm/images/glyphs/*.*"/>
			<file from="root/adm/style/dkp/*.*" to="adm/style/dkp/*.*"/>
			<file from="root/images/class_images/*.*" to="images/class_images/*.*"/>
			<file from="root/images/event_images/*.*" to="images/event_images/*.*"/>
			<file from="root/images/icons/*.*" to="images/icons/*.*"/>
			<file from="root/images/progressbar/*.*" to="images/progressbar/*.*"/>
			<file from="root/images/race_images/*.*" to="images/race_images/*.*"/>
			<file from="root/images/recruitblock_images/*.*" to="images/recruitblock_images/*.*"/>
			<file from="root/images/roster_classes/*.*" to="images/roster_classes/*.*"/>
			<file from="root/images/roster_portraits/*.*" to="images/roster_portraits/*.*"/>
			<file from="root/images/tooltip/*.*" to="images/tooltip/*.*"/>
			<file from="root/includes/acp/acp_dkp_adj.php" to="includes/acp/acp_dkp_adj.php"/>
			<file from="root/includes/acp/acp_dkp_event.php" to="includes/acp/acp_dkp_event.php"/>
			<file from="root/includes/acp/acp_dkp_game.php" to="includes/acp/acp_dkp_game.php"/>
			<file from="root/includes/acp/acp_dkp_item.php" to="includes/acp/acp_dkp_item.php"/>
			<file from="root/includes/acp/acp_dkp_mdkp.php" to="includes/acp/acp_dkp_mdkp.php"/>
			<file from="root/includes/acp/acp_dkp_mm.php" to="includes/acp/acp_dkp_mm.php"/>
			<file from="root/includes/acp/acp_dkp_point.php" to="includes/acp/acp_dkp_point.php"/>
			<file from="root/includes/acp/acp_dkp_raid.php" to="includes/acp/acp_dkp_raid.php"/>
			<file from="root/includes/acp/acp_dkp_sys.php" to="includes/acp/acp_dkp_sys.php"/>
			<file from="root/includes/acp/acp_dkp.php" to="includes/acp/acp_dkp.php"/>
			<file from="root/includes/acp/info/acp_dkp_adj.php" to="includes/acp/info/acp_dkp_adj.php"/>
			<file from="root/includes/acp/info/acp_dkp_event.php" to="includes/acp/info/acp_dkp_event.php"/>
			<file from="root/includes/acp/info/acp_dkp_game.php" to="includes/acp/info/acp_dkp_game.php"/>
			<file from="root/includes/acp/info/acp_dkp_item.php" to="includes/acp/info/acp_dkp_item.php"/>
			<file from="root/includes/acp/info/acp_dkp_mdkp.php" to="includes/acp/info/acp_dkp_mdkp.php"/>
			<file from="root/includes/acp/info/acp_dkp_mm.php" to="includes/acp/info/acp_dkp_mm.php"/>
			<file from="root/includes/acp/info/acp_dkp_point.php" to="includes/acp/info/acp_dkp_point.php"/>
			<file from="root/includes/acp/info/acp_dkp_raid.php" to="includes/acp/info/acp_dkp_raid.php"/>
			<file from="root/includes/acp/info/acp_dkp_sys.php" to="includes/acp/info/acp_dkp_sys.php"/>
			<file from="root/includes/acp/info/acp_dkp.php" to="includes/acp/info/acp_dkp.php"/>
			<file from="root/includes/ucp/ucp_dkp.php" to="includes/ucp/ucp_dkp.php"/>
			<file from="root/includes/ucp/info/ucp_dkp.php" to="includes/ucp/info/ucp_dkp.php"/>
			<file from="root/includes/bbdkp/*.*" to="includes/bbdkp/*.*"/>
			<file from="root/install/*.*" to="install/*.*"/>
			<file from="root/language/en/mods/*.*" to="language/en/mods/*.*"/>
			<file from="root/styles/prosilver/template/dkp/*.*" to="styles/prosilver/template/dkp/*.*"/>
			<file from="root/styles/prosilver/theme/bbdkp.css" to="styles/prosilver/theme/bbdkp.css"/>
			<file from="root/styles/prosilver/theme/jquery-ui-1.8.4.custom.css" to="styles/prosilver/theme/jquery-ui-1.8.4.custom.css"/>
			<file from="root/styles/prosilver/theme/images/dkp/*.*" to="styles/prosilver/theme/images/dkp/*.*"/>
			<file from="root/umil/*.*" to="umil/*.*"/>
		</copy>
		<open src=".htaccess">
			<edit>
				<comment lang="en"><![CDATA[adding htaccess rule to redirect to portal]]></comment>
				<comment lang="fr"><![CDATA[Ajout d’une règle htaccess pour rediriger aux to portail]]></comment>
				<comment lang="de"><![CDATA[Zufügen einer htaccess Regel zum weiterleiten nach dem Portal]]></comment>
				<find><![CDATA[<Files "common.php">
Order Allow,Deny
Deny from All
</Files>]]></find>
				<action type="after-add"><![CDATA[DirectoryIndex portal.php index.php index.html index.htm]]></action>
			</edit>
		</open>
		<open src="common.php">
			<edit>
				<comment lang="en"><![CDATA[adding required classfiles for bbdkp in common.php.]]></comment>
				<comment lang="fr"><![CDATA[Ajout des fichiers requis pour inclusion dans common.php]]></comment>
				<comment lang="de"><![CDATA[Zufügung bbDKP Dateien im common.php]]></comment>
				<find><![CDATA[require($phpbb_root_path . 'includes/utf/utf_tools.' . $phpEx);]]></find>
				<action type="after-add"><![CDATA[// bbDKP
if (file_exists($phpbb_root_path . 'configdkp.' . $phpEx))
{
	require($phpbb_root_path . 'configdkp.' . $phpEx);
}
if(@defined("EMED_BBDKP")) 
{
	require($phpbb_root_path .  'includes/bbdkp/constants_bbdkp.' . $phpEx);
	require($phpbb_root_path .  'includes/bbdkp/bbdkpfunctions.'  . $phpEx);
	require($phpbb_root_path .  'includes/bbdkp/bbdkp.' . $phpEx); 
}]]></action>
			</edit>
		</open>
		<open src="cron.php">
			<edit>
				<comment lang="en"><![CDATA[adding cronjobs]]></comment>
				<comment lang="fr"><![CDATA[ajouter cronjobs]]></comment>
				<comment lang="de"><![CDATA[zufügen cronjobs]]></comment>
				<find><![CDATA[	break;

	case 'prune_forum':
]]></find>
				<action type="replace-with"><![CDATA[	break;

	case 'pointdecay':
	
		if ($config['bbdkp_decaycron'] == 1 && (time() - $config['bbdkp_crontime'] * 3600 <= $config['bbdkp_lastcron']))
		{
			break;
		}

		if ( !class_exists('acp_dkp_raid')) 
		{
			require($phpbb_root_path . 'includes/acp/acp_dkp_raid.' . $phpEx); 
		}
		$acp_dkp_raid = new acp_dkp_raid;
		$acp_dkp_raid->sync_decay($config['bbdkp_decay'], 'cron');
		set_config('bbdkp_lastcron', time(), true);
		break;
		
	case 'prune_forum':
]]></action>
			</edit>
		</open>
		<open src="viewtopic.php">
			<edit>
				<find><![CDATA[	'S_VIEWTOPIC'			=> true,]]></find>
				<action type="after-add"><![CDATA[	// BBDKP
	'S_BBDKP_TOPIC'       => true,
	// BBDKP END]]></action>
			</edit>
			<edit>
				<find><![CDATA[			'SELECT'	=> 'u.*, z.friend, z.foe, p.*',]]></find>
				<action type="replace-with"><![CDATA[	'SELECT'	=> 'u.*, z.friend, z.foe, p.*, 
		bm.member_id, bm.member_level, bm.member_name, bm.member_gender_id, bl.name as class_name, bc.colorcode, bc.imagename, bl1.name as race_name,  br.image_female, br.image_male ',  
]]></action>
			</edit>
			<edit>
				<find><![CDATA[						'ON'	=> 'z.user_id = ' . $user->data['user_id'] . ' AND z.zebra_id = p.poster_id']]></find>
				<action type="after-add"><![CDATA[		), 
		array(
			'FROM'	=> array(MEMBER_LIST_TABLE => 'bm'),
			'ON'	=> 'p.poster_id = bm.phpbb_user_id AND bm.member_rank_id !=90'
			), 
		array(
			'FROM'  => array(CLASS_TABLE => 'bc'),
			'ON'    => "bc.class_id = bm.member_class_id AND bc.game_id = bm.game_id "
			),
			
		array(
			'FROM'  => array(RACE_TABLE => 'br'),
			'ON'    => "br.race_id = bm.member_race_id AND br.game_id = bm.game_id "
			),

		array(
			'FROM'  => array(BB_LANGUAGE => 'bl'),
			'ON'    => "bl.attribute_id = bc.class_id AND bl.language= '" . $config['bbdkp_lang'] . "' AND bl.attribute = 'class'  and bl.game_id = bc.game_id "
			), 
						
		array(
			'FROM'  => array(BB_LANGUAGE => 'bl1'),
			'ON'    => "bl1.attribute_id = br.race_id AND bl1.language= '" . $config['bbdkp_lang'] . "' AND bl1.attribute = 'race'  and bl1.game_id = br.game_id "
]]></action>
			</edit>
			<edit>
				<find><![CDATA[$now = phpbb_gmgetdate(time() + $user->timezone + $user->dst);]]></find>
				<action type="after-add"><![CDATA[//BBDKP
$bbchar = get_bbchar($result);
$db->sql_rowseek(0, $result);
//BBDKP]]></action>
			</edit>
			<edit>
				<find><![CDATA[				'warnings'			=> 0,]]></find>
				<action type="after-add"><![CDATA[				// BBDKP START
				'bbchar'			=> '',
				// BBDKP END]]></action>
			</edit>
			<edit>
				<find><![CDATA[				'posts'			=> $row['user_posts'],]]></find>
				<action type="after-add"><![CDATA[				// BBDKP START
				'bbchar'		=> $bbchar[$poster_id],
				// BBDKP END]]></action>
			</edit>
			<edit>
				<find><![CDATA[	$template->assign_block_vars('postrow', $postrow);]]></find>
				<action type="after-add"><![CDATA[	// BBDKP START
	if (!empty($user_cache[$poster_id]['bbchar']))
	{
		foreach ($user_cache[$poster_id]['bbchar'] as $memberid => $memberdata)
		{
			$template->assign_block_vars('postrow.bbchar', array(
				'BBMEMBERNAME'	=> $memberdata['bbmembername'],
				'BBCOLORCODE'	=> $memberdata['bbcolorcode'],
				'BBRACE'		=> $memberdata['bbrace'],
				'BBRACEIMG'		=> $memberdata['bbraceimg'],
				'BBCLASS'		=> $memberdata['bbclass'],
				'BBCLASSIMG'	=> $memberdata['bbclassimg'],
				'BBLEVEL'		=> $memberdata['bblevel'],
				'U_VIEW_BBMEMBER' => append_sid ( "{$phpbb_root_path}dkp.$phpEx", 'page=viewmember' . '&amp;' . URI_NAMEID . '=' .  $memberid ),
		
			));
		}
	}
	// BBDKP END
]]></action>
			</edit>
			<edit>
				<find><![CDATA[page_footer();]]></find>
				<action type="after-add"><![CDATA[/**
 * retrieves bbDKP character info from sql result.
 * 
 * @param object $result
 * @return array $bbchar
 */
function get_bbchar($bbresult)
{
	global $phpbb_root_path, $db;
	$bbchar= array();
	while ($row = $db->sql_fetchrow($bbresult))
	{
		$poster_id = (int) $row['poster_id'];
		
		if ($poster_id != ANONYMOUS)
		{
			$bb_race_image = (string) (($row['member_gender_id']== 0) ? $row['image_male'] : $row['image_female']);
			$bb_race_image = (strlen($bb_race_image) > 1) ? $phpbb_root_path . "images/race_images/" . $bb_race_image . ".png" : '';
			$bb_class_image = (strlen($row['imagename']) > 1) ? $phpbb_root_path . "images/class_images/" . $row['imagename'] . ".png" : '';
		
			$bbchar[$poster_id][$row['member_id']]['bbmemberid'] = $row['member_id'];
			$bbchar[$poster_id][$row['member_id']]['bbmembername'] = $row['member_name'];
			$bbchar[$poster_id][$row['member_id']]['bbcolorcode'] = $row['colorcode'];
			$bbchar[$poster_id][$row['member_id']]['bbrace'] = $row['race_name'];
			$bbchar[$poster_id][$row['member_id']]['bbraceimg'] = $bb_race_image;
			$bbchar[$poster_id][$row['member_id']]['bbclass'] = $row['class_name'];
			$bbchar[$poster_id][$row['member_id']]['bbclassimg'] = $bb_class_image;
			$bbchar[$poster_id][$row['member_id']]['bblevel'] = $row['member_level'];
		
		}
		
	}
	//do not free result just yet
	return $bbchar;
	
}]]></action>
			</edit>
		</open>
		<open src="includes/functions.php">
			<edit>
				<comment lang="en"><![CDATA[ preloading dkp language files in functions.php]]></comment>
				<comment lang="fr"><![CDATA[ ajouter le fichier de langue dans fonctions.php ]]></comment>
				<comment lang="de"><![CDATA[ zufügen dkp Sprachdatei in functions.php]]></comment>
				<find><![CDATA[if (defined('HEADER_INC'))]]></find>
				<action type="before-add"><![CDATA[$user->add_lang(array('mods/dkp_common'));
]]></action>
			</edit>
			<edit>
				<comment lang="en"><![CDATA[ adding labels  ]]></comment>
				<comment lang="en"><![CDATA[ ajouter des labels ]]></comment>
				<comment lang="en"><![CDATA[ zufügen labels  ]]></comment>
				<find><![CDATA[		'L_INDEX'			=> $user->lang['FORUM_INDEX'],]]></find>
				<action type="after-add"><![CDATA[		'L_PORTAL'			=> $user->lang['PORTAL'],]]></action>
			</edit>
			<edit>
				<comment lang="en"><![CDATA[adding links]]></comment>
				<comment lang="en"><![CDATA[ajouter links]]></comment>
				<comment lang="en"><![CDATA[zufügen Links]]></comment>
				<find><![CDATA[		'U_INDEX'				=> append_sid("{$phpbb_root_path}index.$phpEx"),]]></find>
				<action type="after-add"><![CDATA[		'U_PORTAL'		=> append_sid("{$phpbb_root_path}portal.$phpEx"),
		'U_DKP'			=> append_sid("{$phpbb_root_path}dkp.$phpEx", 'page=standings'),
		'L_DKPPAGE'		=> $user->lang['DKP'],
		'L_BBDKP'		=> $user->lang['FOOTERBBDKP'],
		'U_ABOUT'         => append_sid("{$phpbb_root_path}aboutbbdkp.$phpEx"),
]]></action>
			</edit>
			<edit>
				<comment lang="en"><![CDATA[adding cronjobs in footer function]]></comment>
				<comment lang="en"><![CDATA[ajouter cronjobs dans la fonction footer]]></comment>
				<comment lang="en"><![CDATA[zufügen Cronjobs in die footer Funktion]]></comment>
				<find><![CDATA[			$cron_type = 'tidy_sessions';
		}]]></find>
				<action type="after-add"><![CDATA[		// bbDKP cron job
		else if (array_key_exists ('bbdkp_crontime', $config))
		{
			if ($time_now - $config['bbdkp_crontime']*3600 > $config['bbdkp_lastcron'])
			{
				$cron_type = 'pointdecay';
			}
		}]]></action>
			</edit>
		</open>
		<open src="/styles/prosilver/template/overall_footer.html">
			<edit>
				<comment lang="en"><![CDATA[Adding bbdkp credits link in overall_footer ]]></comment>
				<comment lang="fr"><![CDATA[Ajout lien les crédits dans overall_footer ]]></comment>
				<comment lang="de"><![CDATA[Zufügung Credits link in overall_footer ]]></comment>
				<find><![CDATA[		<!-- IF TRANSLATION_INFO --><br />{TRANSLATION_INFO}<!-- ENDIF -->]]></find>
				<action type="replace-with"><![CDATA[<br />
<script type="text/javascript">
function pop_aboutbbdkp()
{
    search = window.open('aboutbbdkp.php','search','resizable=no,toolbar=no,status=no,height=400,width=680,screenX=50,screenY=25,left=100,top=70');
    search.focus();
}
</script>
<a class="bbdkpcredits" onclick="javascript:pop_aboutbbdkp();" style="cursor:pointer;" onmouseover="style.textDecoration='underline';" onmouseout="style.textDecoration='none';">{L_BBDKP}</a><br />
		<!-- IF TRANSLATION_INFO --><br />{TRANSLATION_INFO}<!-- ENDIF -->]]></action>
			</edit>
		</open>
		<open src="styles/prosilver/template/overall_header.html">
			<edit>
				<comment lang="en"><![CDATA[install bbDKP header - All in one file]]></comment>
				<comment lang="fr"><![CDATA[installation du fichier header - tous en un]]></comment>
				<comment lang="de"><![CDATA[Installation Headerdatei - Alles in einem]]></comment>
				<find><![CDATA[</head>]]></find>
				<action type="before-add"><![CDATA[<!-- INCLUDE dkp/dkpheader.html -->]]></action>
			</edit>
			<edit>
				<comment lang="en"><![CDATA[insert links in template]]></comment>
				<comment lang="fr"><![CDATA[inserer liens dans template]]></comment>
				<comment lang="de"><![CDATA[inseriere Links im Template]]></comment>
				<find><![CDATA[<li class="icon-home"><a href="{U_INDEX}" accesskey="h">{L_INDEX}</a>]]></find>
				<action type="before-add"><![CDATA[<li class="icon-home"><a href="{U_PORTAL}">{L_PORTAL}</a></li>
				<li class="icon-faq"><a href="{U_DKP}">{L_DKPPAGE}</a><!-- BEGIN dkpnavlinks --> <strong>&#8249;</strong> <a href="{dkpnavlinks.U_DKPPAGE}">{dkpnavlinks.DKPPAGE}</a><!-- END dkpnavlinks --></li>
				]]></action>
			</edit>
		</open>
		<open src="styles/prosilver/template/viewtopic_body.html">
			<edit>
				<find><![CDATA[			</dd>
		<!-- ENDIF -->
		<!-- ENDIF -->
]]></find>
				<action type="after-add"><![CDATA[		
		<!-- BBDKP START -->
		<dd>&nbsp;</dd>
		<dd>&nbsp;</dd>
		<dd>
			<!-- BEGIN bbchar -->
			<ul style="list-style: none;">
				<li>
				<!-- IF postrow.bbchar.BBRACEIMG --><img src="{postrow.bbchar.BBRACEIMG}" alt="{postrow.bbchar.RACE}" /> <!-- ENDIF -->
				<!-- IF postrow.bbchar.BBCLASSIMG --><img src="{postrow.bbchar.BBCLASSIMG}" alt="{postrow.bbchar.CLASS}" /> <!-- ENDIF -->
				<a href="{postrow.bbchar.U_VIEW_BBMEMBER}"><span style="white-space: nowrap; color:{postrow.bbchar.BBCOLORCODE}">{postrow.bbchar.BBMEMBERNAME}</span> </a> 
				<strong><!-- IF postrow.bbchar.BBLEVEL -->{postrow.bbchar.BBLEVEL}<!-- ENDIF --></strong>
				</li>
			</ul>
			<!-- END bbchar -->
		</dd>
		<!-- BBDKP END -->
]]></action>
			</edit>
		</open>		
		<open src="adm/style/overall_header.html">
			<edit>
				<comment lang="en"><![CDATA[adding jquery scripts to admin header]]></comment>
				<comment lang="fr"><![CDATA[ajout de scripts jquery au header admin ]]></comment>
				<comment lang="de"><![CDATA[Zufügung jquery header scripts im admin]]></comment>
				<find><![CDATA[</head>]]></find>
				<action type="before-add"><![CDATA[<!-- begin bbdkp -->
	<script type="text/javascript" src="style/dkp/jquery.js"></script>
	<script type="text/javascript" src="style/dkp/farbtastic.js"></script>
	<link rel="stylesheet" href="style/dkp/farbtastic.css" type="text/css" />
	<link rel="stylesheet" href="style/dkp/bbdkp.css" type="text/css" />
<!-- end bbdkp -->
		                ]]></action>
			</edit>
		</open>
		<open src="/styles/prosilver/theme/stylesheet.css">
			<edit>
				<comment lang="en"><![CDATA[bbdkp css]]></comment>
				<comment lang="fr"><![CDATA[bbdkp css]]></comment>
				<comment lang="de"><![CDATA[bbdkp css]]></comment>
				<find><![CDATA[@import url("colours.css");]]></find>
				<action type="after-add"><![CDATA[@import url("bbdkp.css");
]]></action>
			</edit>
		</open>
		
		<php-installer><![CDATA[install/index.php]]></php-installer>
		<diy-instructions lang="en"><![CDATA[bbDKP 1.2.7 was installed. You need to run the database installer now.

1) Run bbDKP 1.2.7 database installation : install/index.php 
2) Rename the install folder. 

Please see the full installation, upgrade instructions and changelog here : /docs/install.html
Note : Should you need to deactivate bbDKP you can open configdkp.php change  @define('EMED_BBDKP', true);  to  //@define('EMED_BBDKP', true);  

Enjoy ;)]]></diy-instructions>
		<diy-instructions lang="fr"><![CDATA[bbDKP 1.2.7 a été installé. Il vous reste de lancer l'installateur database. 

le guide d’installation, mise à jour et Liste des changements : /docs/install.html

Résumé des étapes de post-installation

1) lance l’installateur ou m.a.j 1.2.7  : install/index.php
2) Renomme ou supprime le repertoire /install pour réactiver le forum.

Note : Il est possible de désactiver le MOD en ouvrant configdkp.php et en changeant  @define('EMED_BBDKP', true);  à  //@define('EMED_BBDKP', true);  

Success ;)]]></diy-instructions>
		<diy-instructions lang="de"><![CDATA[bbDKP 1.2.7 ist jetzt installiert. Jetzt nur noch die Datenbank Installierung :

1) öffne install/index.php und klicke auf Install oder Update.
2) lösche oder umbenenne das Installations-Verzeichnis „install" 

Notiz : bbDKP kan deaktiviert werden indem sie configdkp.php öffnen und @define('EMED_BBDKP', true); ändern nach  //@define('EMED_BBDKP', true);  

Viel Spaß ;)]]></diy-instructions>
	</action-group>
</mod>
